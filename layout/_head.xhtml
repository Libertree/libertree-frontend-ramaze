<head>
  <title>#{( @num_unseen && ( @num_unseen > 0 ) ) ? "(#{@num_unseen})" : ''} Libertree#{ $conf['title_insert'] ? " - #{::CGI.escape_html($conf['title_insert'])}" : '' }#{ @subtitle ? " - #{::CGI.escape_html(@subtitle)}" : '' }</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>

  #{ css 'ui-lightness/jquery-ui-1.8.21.custom' }
  #{ css 'chosen' }
  #{ css 'bootstrap' }
  #{ css_nocache 'application' }
  #{ css_nocache (account.font_css || 'fonts') }
  #{ css_nocache 'single-post-view' }
  #{ css_nocache 'excerpts-view' }
  #{ css_nocache 'profiles' }
  #{ css_nocache 'messages' }
  #{ css_nocache 'chat' }
  #{ css_nocache 'search' }
  <?r if account.admin? ?>
    #{ css_nocache 'admin' }
  <?r end ?>

  #{ @stylesheet_extra }

  #{ js 'jquery-1.7.2.min' }
  #{ js 'jquery-ui-1.8.21.custom.min' }
  #{ js 'jquery.mousewheel.min' }
  #{ js 'jquery.expandable' }
  #{ js 'jquery.cookie' }
  #{ js 'chosen.jquery.min' }
  #{ js 'textinputs_jquery' }
  #{ js 'bootstrap.tooltip.popover' }

  #{ js_nocache 'libertree' }
  #{ js_nocache 'libertree/post_loader' }
  #{ js_nocache 'libertree/ui' }
  #{ js_nocache 'libertree/session' }
  #{ js_nocache 'application' }
  #{ js_nocache 'likes' }
  #{ js_nocache 'comments' }
  #{ js_nocache 'markdown-injector' }
  #{ js_nocache 'notifications' }
  #{ js_nocache 'chat' }
  #{ js_nocache 'post' }
  #{ js_nocache 'post-new' }
  #{ js_nocache 'river' }
  #{ js_nocache 'river-new' }
  #{ js_nocache 'pool' }
  #{ js_nocache 'home' }
  #{ js_nocache 'messages' }
  #{ js_nocache 'profile' }
  #{ js_nocache 'contact-lists' }
  <?r if ! $conf['websocket_blacklist'].include?(account.username) ?>
    #{ js_nocache 'websocket' }
  <?r end ?>
  <?r if account.admin? ?>
    #{ js_nocache 'admin' }
  <?r end ?>
  #{ controller_js }

  <style type="text/css">
    .excerpts-view .post-excerpt div.excerpt .overflowed {
      max-height: #{
        account.excerpt_max_height ?  account.excerpt_max_height.to_s+'px' : 'auto'
      };
    }
    #{account.custom_css}
  </style>

  <script type="text/javascript">
    var host = #{ request.host.inspect };
    var layout = #{ session[:layout].to_s.inspect };

    #{account.custom_js}
  </script>
</head>
