<head>
  <title>#{( @num_unseen && ( @num_unseen > 0 ) ) ? "(#{@num_unseen})" : ''} Libertree#{ $conf['title_insert'] ? " - #{::CGI.escape_html($conf['title_insert'])}" : '' }#{ @subtitle ? " - #{::CGI.escape_html(@subtitle)}" : '' }</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>

  #{ css 'ui-lightness/jquery-ui-1.8.21.custom' }
  #{ css 'chosen' }
  <link href="/css/application.css?t=#{File.mtime('public/css/application.css').to_i}" media="screen" rel="stylesheet" type="text/css" />
  <link href="/css/#{account.font_css || 'fonts'}.css?t=#{File.mtime('public/css/' + (account.font_css || 'fonts') + '.css').to_i}" media="screen" rel="stylesheet" type="text/css" />
  <link href="/css/single-post-view.css?t=#{File.mtime('public/css/single-post-view.css').to_i}" media="screen" rel="stylesheet" type="text/css" />
  <link href="/css/excerpts-view.css?t=#{File.mtime('public/css/excerpts-view.css').to_i}" media="screen" rel="stylesheet" type="text/css" />
  <link href="/css/messages.css?t=#{File.mtime('public/css/messages.css').to_i}" media="screen" rel="stylesheet" type="text/css" />
  <link href="/css/chat.css?t=#{File.mtime('public/css/chat.css').to_i}" media="screen" rel="stylesheet" type="text/css" />
  <?r if account.admin? ?>
    <link href="/css/admin.css?t=#{File.mtime('public/css/admin.css').to_i}" media="screen" rel="stylesheet" type="text/css" />
  <?r end ?>

  #{ @stylesheet_extra }

  #{ js 'jquery-1.7.2.min' }
  #{ js 'jquery-ui-1.8.21.custom.min' }
  #{ js 'jquery.mousewheel.min' }
  #{ js 'jquery.expandable' }
  #{ js 'jquery.cookie' }
  #{ js 'chosen.jquery.min' }
  #{ js 'textinputs_jquery' }

  #{ js_nocache 'application' }
  #{ js_nocache 'comments' }
  #{ js_nocache 'markdown-injector' }
  #{ js_nocache 'notifications' }
  #{ js_nocache 'chat' }
  #{ js_nocache 'post' }
  #{ js_nocache 'post-new' }
  #{ js_nocache 'river' }
  #{ js_nocache 'river-new' }
  #{ js_nocache 'pool' }
  #{ js_nocache 'home' }
  #{ js_nocache 'messages' }
  #{ js_nocache 'profile' }
  #{ js_nocache 'contact-lists' }
  <?r if ! $conf['websocket_blacklist'].include?(account.username) ?>
    #{ js_nocache 'websocket' }
  <?r end ?>
  <?r if account.admin? ?>
    #{ js_nocache 'admin' }
  <?r end ?>
  <?r if @continuous_scrolling ?>
    #{ js_nocache 'continuous-scrolling' }
  <?r end ?>

  <style type="text/css">
    .excerpts-view .post-excerpt div.excerpt .height-fixed {
      max-height: #{
        account.excerpt_max_height ?  account.excerpt_max_height.to_s+'px' : 'auto'
      };
    }
    #{account.custom_css}
  </style>

  <script type="text/javascript">
    var host = #{ request.host.inspect };
    var layout = #{ session[:layout].to_s.inspect };

    #{account.custom_js}
  </script>
</head>
