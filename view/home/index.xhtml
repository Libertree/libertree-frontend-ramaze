#{ render_file 'layout/_sidebar.xhtml' }

<!-- TODO: DRY up with New Post page -->
<form id="post-new">
  <h3>#{_('New Post')}</h3>
  #{ Controller::Main.render_partial '_markdown_injector' }
  <textarea name="text" rows="5" id="textarea-post-new">#{session[:saved_text]['textarea-post-new']}</textarea>
  <div id="settings">
    #{_('Visibility')}: <select name="visibility">
      <option value="internet">#{s_('visibility|Internet')}</option>
      <option value="forest" selected>#{s_('visibility|Forest')}</option>
    </select>
    <?r if @springs.any? ?>
      <div id="springs">
        #{_('Publish to these springs:')}
        <?r @springs.each do |spring| ?>
          <input name="spring_ids[]" type="checkbox" value="#{spring.id}">#{spring.name}</input>
        <?r end ?>
      </div>
    <?r end ?>
  </div>
  <div class="form-buttons">
    <input type="submit" value="#{s_('new-post|Post')}" tabindex="1"/>
    <input class="preview" type="button" value="#{_('Preview')}" tabindex="2" data-type="post" data-preview-heading="#{_('Preview')}" data-preview-close-label="#{s_('preview|close')}" />
  </div>
  <input type="hidden" name="river_id" value="#{@river.id}"/>
  <div class="message"></div>
</form>

<?r if @no_rivers ?>
  <div id="no-rivers" class="panel">
    <p>
      #{_('In order to see posts here, you need to have at least one river.')}
    </p>
    <p>
      #{_('%sCreate one now%s') % ["<a href='/rivers/new'>", "</a>"]}
    </p>
  </div>
<?r else ?>
  <div id="post-excerpts" data-river-id="#{@river ? @river.id : ''}">
    <div class="more-posts">
      <a href="#" class="load-more"></a>
    </div>
    <?r if @posts.empty? ?>
      <div id="no-more-posts" class="panel">
        #{_('No more posts (for now).')}
      </div>
    <?r else ?>
      <?r @posts.reverse.each_with_index do |post, index| ?>
        #{ Controller::Posts.render_partial '_excerpt', post: post, river_post_order: @river_post_order, is_first: index == 0 }
      <?r end ?>
    <?r end ?>
    <div class="spinner"></div>
  </div>

  <?r if @river && @river.being_processed? ?>
    <div id="no-more-posts" class="panel">
    #{_('The system is still matching posts with this river. Check in a few minutes for more posts.')}
    </div>
  <?r end ?>
<?r end ?>
