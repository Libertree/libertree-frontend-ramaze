<div class="post has-shadow" data-post-id="#{@post.id}">
  <?r if session[:layout] != 'narrow' ?>
    <div class="post-pane">
  <?r end ?>
      <div class="post-proper">
        <div class="member">
          #{member_avatar_link(@post.member)}
          <div class="member-name">#{member_name_link(@post.member)}</div>
          <div class="age">#{ago(@post.time_created)}</div>
          <?r if @post.time_created != @post.time_updated ?>
            <span class="age-update">(updated #{ago(@post.time_updated)})</span>
          <?r end ?>
        </div>

        <div class="post-tools">
          <?r if logged_in? ?>
            <?r if @post.member == account.member ?>
              <a href="/posts/edit/#{@post.id}" class="edit">#{_('edit')}</a>
              <a href="/posts/destroy/#{@post.id}" data-msg="#{_('Delete this post?')}" class="delete">#{_('delete')}</a>
            <?r end ?>

            <?r if @post.like_by(account.member) ?>
              <a href="#" class="unlike" data-post-like-id="#{@post.like_by(account.member).id}">#{ img 'icon-unlike.png', {alt:_('unlike'), class:'size-16'}}</a>
              <a href="#" class="like hidden">#{ img 'icon-like.png', {alt:_('like'), class:'size-16'}}</a>
            <?r else ?>
              <a href="#" class="like">#{ img 'icon-like.png', {alt:_('like'), class:'size-16'}}</a>
              <a href="#" class="unlike hidden">#{ img 'icon-unlike.png', {alt:_('unlike'), class:'size-16'}}</a>
            <?r end ?>

            <?r if @post.collected_by?(account) ?>
              <a class="collect collected" href="#" title="#{_('Collect this post in a pool')}">#{ img 'icon-collected.png', {alt:_('collected'), class:'size-16'}}</a>
              <a class="collect hidden" href="#" title="#{_('Collect this post in a pool')}">#{ img 'icon-collect.png', {alt:_('collect'), class:'size-16'}}</a>
            <?r else ?>
              <a class="collect" href="#" title="#{_('Collect this post in a pool')}">#{ img 'icon-collect.png', {alt:_('collect'), class:'size-16'}}</a>
              <a class="collect collected hidden" href="#" title="#{_('Collect this post in a pool')}">#{ img 'icon-collected.png', {alt:_('collected'), class:'size-16'}}</a>
            <?r end ?>

            <?r if ! account.subscribed_to?(@post) ?>
              <a href="#" class="subscribe" title="#{_('Start receiving notifications about comments on this post')}">#{ img 'icon-subscribe.png', {alt:_('subscribe'), class: "size-16"}}</a>
              <a href="#" class="unsubscribe hidden" title="#{_('Stop receiving notifications about comments on this post')}">#{ img 'icon-unsubscribe.png', {alt:_('unsubscribe'), class: "size-16"}}</a>
            <?r else ?>
              <a href="#" class="subscribe hidden" title="#{_('Start receiving notifications about comments on this post')}">#{ img 'icon-subscribe.png', {alt:_('subscribe'), class: "size-16"}}</a>
              <a href="#" class="unsubscribe" title="#{_('Stop receiving notifications about comments on this post')}">#{ img 'icon-unsubscribe.png', {alt:_('unsubscribe'), class: "size-16"}}</a>
            <?r end ?>

            <?r if @post.read_by?(account) ?>
              <a class="mark-unread" title="#{_('mark post unread')}" href="#">#{ img 'icon-read.png', {alt:_('mark post unread'), class:'size-16'}}</a>
              <a class="mark-read hidden" title="#{_('mark post read')}" href="#">#{ img 'icon-unread.png', {alt:_('mark post read'), class:'size-16'}}</a>
            <?r else ?>
              <a class="mark-unread hidden" title="#{_('mark post unread')}" href="#">#{ img 'icon-read.png', {alt:_('mark post unread'), class:'size-16'}}</a>
              <a class="mark-read" title="#{_('mark post read')}" href="#">#{ img 'icon-unread.png', {alt:_('mark post unread'), class:'size-16'}}</a>
            <?r end ?>
          <?r end ?>
          <a href="#" id="comments-show" title="show comments">&lt;&lt;</a>
          <a href="#" id="comments-hide" title="hide comments">&gt;&gt;</a>
          <br/>
          <?r if logged_in? ?>
            <a class="visibility" href="#" rel="popover" title="#{_('Visibility')}" data-content="#{visibility_description(@post)}">#{img 'icon-eye.png', {class:"size-16", alt: visibility_description(@post)}}</a>
          <?r end ?>
          <span class="num-likes #{@post.likes.empty? ? 'hidden' : ''}" title="#{like_list(@post)}">#{img 'icon-like.png', {class:"size-16", alt:_('likes')}} <span class="value">#{@post.likes.size}</span></span>
        </div>

        <div class="post-text typed-text">
          #{@post.text_rendered(account)}
        </div>
      </div>
  <?r if session[:layout] != 'narrow' ?>
    </div>

    <div class="comments-pane">
  <?r end ?>
      #{ Controller::Comments.render_partial "_comments_list", post: @post, comment_fetch_options: @comment_fetch_options, hidden: false }
  <?r if session[:layout] != 'narrow' ?>
    </div>
  <?r end ?>
</div>
