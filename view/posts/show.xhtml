<div class="post" data-post-id="#{@post.id}">
  <?r if session[:layout] != 'narrow' ?>
    <div class="post-pane">
  <?r end ?>
      <div class="post-tools">
        <?r if logged_in? ?>
          <?r if ! account.subscribed_to?(@post) ?>
            <a href="#" class="subscribe" title="#{_('Start receiving notifications about comments on this post')}">#{_('subscribe')}</a>
            <a href="#" class="unsubscribe hidden" title="#{_('Stop receiving notifications about comments on this post')}">#{_('unsubscribe')}</a>
          <?r else ?>
            <a href="#" class="subscribe hidden" title="#{_('Start receiving notifications about comments on this post')}">#{_('subscribe')}</a>
            <a href="#" class="unsubscribe" title="#{_('Stop receiving notifications about comments on this post')}">#{_('unsubscribe')}</a>
          <?r end ?>

          <?r if @post.read_by?(account) ?>
            <a href="#" class="mark-unread">#{_('mark post unread')}</a>
            <a href="#" class="mark-read hidden">#{_('mark post read')}</a>
          <?r else ?>
            <a href="#" class="mark-unread hidden">#{_('mark post unread')}</a>
            <a href="#" class="mark-read">#{_('mark post read')}</a>
          <?r end ?>

          <?r if @post.member == account.member ?>
            <a href="/posts/edit/#{@post.id}" class="edit">#{_('edit')}</a>
            <a href="/posts/destroy/#{@post.id}" class="delete">#{_('delete')}</a>
          <?r end ?>

          <a class="collect" href="#" title="Collect this post in a pool">#{_('collect')}</a>

          <?r if @post.like_by(account.member) ?>
            <a href="#" class="unlike" data-post-like-id="#{@post.like_by(account.member).id}">#{_('unlike')}</a>
            <a href="#" class="like hidden">#{_('like')}</a>
          <?r else ?>
            <a href="#" class="like">#{_('like')}</a>
            <a href="#" class="unlike hidden">#{_('unlike')}</a>
          <?r end ?>
        <?r end ?>
        <a href="#" id="comments-show" title="show comments">&lt;&lt;</a>
        <br/>
        <span class="num-likes #{@post.likes.empty? ? 'hidden' : ''}" title="#{@post.likes.map { |l| ::CGI.escape_html(l.member.name_display) }.join(', ')}"><img src="/images/icon-like.png" class="size-16" alt="#{_('likes')}"/> <span class="value">#{@post.likes.size}</a></span>
      </div>

      <div class="post-proper">
        #{member_avatar_link(@post.member)}
        <div class="member-name">#{member_name_link(@post.member)}</div>
        <div class="age">#{ago(@post.time_created)}</div>
        <?r if @post.time_created != @post.time_updated ?>
          <span class="age-update">(updated #{ago(@post.time_updated)})</span>
        <?r end ?>
        <div class="post-text typed-text">
          #{@post.text_rendered( logged_in? && account.autoembed )}
        </div>
      </div>
  <?r if session[:layout] != 'narrow' ?>
    </div>

    <div class="comments-pane">
      <a href="#" id="comments-hide" title="hide comments">&gt;&gt;</a>
  <?r end ?>
      #{ render_file 'view/comments/_comments.xhtml', post: @post, hidden: false }
  <?r if session[:layout] != 'narrow' ?>
    </div>
  <?r end ?>
</div>
