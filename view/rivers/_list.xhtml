<?r @posts.each do |post| ?>
  <div class="post-excerpt" data-post-id="#{post.id}">
    <table><tr>
      <td class="meta"><div class="height-fixed">
        <div class="member">
          #{member_avatar_link(post.member)}
          <span class="member-name">#{member_name_link(post.member)}</span>
        </div>
        <div class="post-stats">
          <span class="age">#{ago(post.time_created)}</span><br/>
          <span class="num-likes #{post.likes.empty? ? 'hidden' : ''}" title="#{_('Liked by %s') % post.likes.map { |l| ::CGI.escape_html(l.member.name_display) }.join(', ')}"><img src="/images/icon-like.png" class="size-16" alt="#{_('likes')}"/> <span class="value">#{post.likes.size}</span></span><br/>
          <span class="num-comments #{post.comments.empty? ? 'hidden' : ''}" title="#{n_('1 comment by %1$s', '%2$d comments by %1$s', post.comments.count) % [post.comments.map { |l| ::CGI.escape_html(l.member.name_display) }.uniq.join(', '), post.comments.count]}"><img src="/images/icon-comment.png" class="size-16" alt="#{_('comments')}"/> #{post.comments.size}</span><br/>
        </div>
        <div class="post-tools">
          <?r if post.like_by(account.member) ?>
            <a class="unlike" data-post-like-id="#{post.like_by(account.member).id}">#{_('unlike')}</a>
            <a class="like hidden">#{_('like')}</a>
          <?r else ?>
            <a class="like">#{_('like')}</a>
            <a class="unlike hidden">#{_('unlike')}</a>
          <?r end ?>

          <a class="comment">#{_('comment')}</a>

          <?r if post.member == account.member ?>
            <a href="/posts/edit/#{post.id}" class="edit">#{_('edit')}</a>
            <?r if post.comments.size == 0 ?>
              <a class="delete" href="#">#{_('delete')}</a>
            <?r end ?>
          <?r end ?>

          <?r if post.read_by?(account) ?>
            <a class="mark-unread" href="#">#{_('mark unread')}</a>
            <a class="mark-read hidden" href="#">#{_('mark read')}</a>
          <?r else ?>
            <a class="mark-unread hidden" href="#">#{_('mark unread')}</a>
            <a class="mark-read" href="#">#{_('mark read</a>
          <?r end ?>

          <div class="link-view-post">
            <a href="/posts/show/#{post.id}" title="#{_('Middle click, Shift-click, or Ctrl-Shift-click to open in new tab/window')}">#{_('view post')}</a>
          </div>
        </div>
      </div></td>
      <td class="excerpt">
        <div class="height-fixed"><div class="overflowed">
          <div class="post-text typed-text">
            #{Libertree.render(post.text)}
          </div>
          #{ render_file 'view/comments/_comments.xhtml', post: post, hidden: true }
        </div></div>
        <div class="show-more"><a href="#">#{_('show more')}</a></div>
        <div class="show-less"><a href="#">#{_('show less')}</a></div>
      </td>
    </tr></table>
  </div>
<?r end ?>
